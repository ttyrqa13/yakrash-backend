# YaKrash Backend

Node.js + Express + PostgreSQL + WebSocket backend –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ø–ö—Ä–∞—à.

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# 2. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª .env
cp .env.example .env

# 3. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env (—É–∫–∞–∑–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ë–î, JWT secret, SMTP)
nano .env

# 4. –°–æ–∑–¥–∞—Ç—å –ë–î –∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ö–µ–º—É
psql -U postgres -d yakrash_db -f ../database/schema.sql

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
npm start

# –ò–ª–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π)
npm run dev
```

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
backend/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ database.js          # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
‚îú‚îÄ‚îÄ cron/
‚îÇ   ‚îî‚îÄ‚îÄ reminders.js         # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îî‚îÄ‚îÄ auth.js              # JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îú‚îÄ‚îÄ auth.js              # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–≤—Ö–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ users.js             # –ü—Ä–æ—Ñ–∏–ª—å, –∞–≤–∞—Ç–∞—Ä–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ appointments.js      # –ó–∞–ø–∏—Å–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ chats.js             # –ß–∞—Ç—ã –∏ —Å–æ–æ–±—â–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ notifications.js     # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚îú‚îÄ‚îÄ sockets/
‚îÇ   ‚îî‚îÄ‚îÄ chat.js              # WebSocket –¥–ª—è —á–∞—Ç–æ–≤
‚îú‚îÄ‚îÄ server.js                # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª
‚îî‚îÄ‚îÄ package.json
```

## üîå API Endpoints

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- `POST /api/auth/register` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `POST /api/auth/login` - –í—Ö–æ–¥
- `GET /api/auth/me` - –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `GET /api/users/:id` - –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `PUT /api/users/me` - –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
- `POST /api/users/me/avatar` - –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä
- `DELETE /api/users/me` - –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
- `GET /api/users/search/salons` - –ü–æ–∏—Å–∫ —Å–∞–ª–æ–Ω–æ–≤
- `POST /api/users/subscribe/:salonId` - –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Å–∞–ª–æ–Ω
- `DELETE /api/users/subscribe` - –û—Ç–ø–∏—Å–∞—Ç—å—Å—è
- `GET /api/users/salon/subscribers` - –ü–æ–¥–ø–∏—Å—á–∏–∫–∏ (–∞–¥–º–∏–Ω–∫–∞)

### –ó–∞–ø–∏—Å–∏
- `GET /api/appointments` - –í—Å–µ –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /api/appointments/:id` - –ó–∞–ø–∏—Å—å –ø–æ ID
- `POST /api/appointments` - –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å
- `PUT /api/appointments/:id` - –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å
- `DELETE /api/appointments/:id` - –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å
- `GET /api/appointments/salon/all` - –ó–∞–ø–∏—Å–∏ —Å–∞–ª–æ–Ω–∞ (–∞–¥–º–∏–Ω–∫–∞)
- `POST /api/appointments/salon/client` - –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –∫–ª–∏–µ–Ω—Ç–∞ (–∞–¥–º–∏–Ω–∫–∞)

### –ß–∞—Ç—ã
- `GET /api/chats` - –í—Å–µ —á–∞—Ç—ã
- `POST /api/chats/with/:userId` - –°–æ–∑–¥–∞—Ç—å/–ø–æ–ª—É—á–∏—Ç—å —á–∞—Ç
- `GET /api/chats/:chatId/messages` - –°–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞
- `POST /api/chats/:chatId/messages` - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
- `POST /api/chats/:chatId/read` - –ü–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ
- `DELETE /api/chats/:chatId` - –£–¥–∞–ª–∏—Ç—å —á–∞—Ç

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `GET /api/notifications` - –í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `GET /api/notifications/unread/count` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
- `POST /api/notifications/:id/read` - –ü–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ
- `POST /api/notifications/read-all` - –ü—Ä–æ—á–∏—Ç–∞—Ç—å –≤—Å–µ
- `DELETE /api/notifications/:id` - –£–¥–∞–ª–∏—Ç—å
- `POST /api/notifications/broadcast` - –†–∞—Å—Å—ã–ª–∫–∞ (–∞–¥–º–∏–Ω–∫–∞)

## üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

–í—Å–µ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ endpoints —Ç—Ä–µ–±—É—é—Ç JWT —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ:

```
Authorization: Bearer YOUR_JWT_TOKEN
```

## üí¨ WebSocket Events

### Client ‚Üí Server
- `chat:join` - –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ —á–∞—Ç—É
- `chat:leave` - –ü–æ–∫–∏–Ω—É—Ç—å —á–∞—Ç
- `message:send` - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
- `typing:start` - –ù–∞—á–∞–ª –ø–µ—á–∞—Ç–∞—Ç—å
- `typing:stop` - –ü–µ—Ä–µ—Å—Ç–∞–ª –ø–µ—á–∞—Ç–∞—Ç—å
- `message:read` - –ü—Ä–æ—á–∏—Ç–∞–ª —Å–æ–æ–±—â–µ–Ω–∏–µ

### Server ‚Üí Client
- `users:online` - –°–ø–∏—Å–æ–∫ –æ–Ω–ª–∞–π–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `user:online` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —Å–µ—Ç–∏
- `user:offline` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ñ—Ñ–ª–∞–π–Ω
- `message:new` - –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- `user:typing` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—á–∞—Ç–∞–µ—Ç
- `user:stop-typing` - –ü–µ—Ä–µ—Å—Ç–∞–ª –ø–µ—á–∞—Ç–∞—Ç—å
- `message:read` - –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ
- `notification:new` - –ù–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

## ‚è∞ Cron –∑–∞–¥–∞—á–∏

–ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è upcoming –∑–∞–ø–∏—Å–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:
- –ó–∞ 24 —á–∞—Å–∞
- –ó–∞ 3 —á–∞—Å–∞
- –ó–∞ 1 —á–∞—Å
- –ó–∞ 30 –º–∏–Ω—É—Ç
- –ó–∞ 15 –º–∏–Ω—É—Ç

Email –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π SMTP.

## üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–º. `.env.example`

–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:
- `DATABASE_URL` - PostgreSQL connection string
- `JWT_SECRET` - –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è JWT (32+ —Å–∏–º–≤–æ–ª–æ–≤!)
- `SMTP_*` - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è email

## üöÄ –î–µ–ø–ª–æ–π

### Railway.app (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –î–æ–±–∞–≤–∏—Ç—å PostgreSQL —Å–µ—Ä–≤–∏—Å
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
4. Deploy –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### VPS
1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. `npm install`
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `.env`
4. `pm2 start server.js --name yakrash-api`
5. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Nginx reverse proxy

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
